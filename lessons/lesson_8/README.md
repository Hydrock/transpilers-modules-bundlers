# Lesson 8

Webpack Hot Module Replacement

https://webpack.js.org/configuration/dev-server/

HMR ‚Äî –æ–¥–Ω–∞ –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π Webpack, –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–∞—è –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ UI, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –º–æ–¥—É–ª–∏ –±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

üîπ –®–∞–≥ 1: –ß—Ç–æ —Ç–∞–∫–æ–µ HMR –∏ –∫–∞–∫ –æ–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

‚ùì –ß—Ç–æ —Ç–∞–∫–æ–µ Hot Module Replacement (HMR)?

HMR ‚Äî —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å Webpack –æ–±–Ω–æ–≤–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ –±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

üì¶ –í–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏, Webpack:
	1.	–û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ–¥—É–ª–µ.
	2.	–ü–µ—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç –º–æ–¥—É–ª—å.
	3.	–û–±–Ω–æ–≤–ª—è–µ—Ç –µ–≥–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç React state).

üîÅ –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Live Reload –∏ Hot Reload

### üîÅ –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Live Reload –∏ Hot Module Replacement (HMR)

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å         | **Live Reload**                | **Hot Module Replacement (HMR)**     |
|---------------------|--------------------------------|--------------------------------------|
| –ß—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è     | –í—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ü–µ–ª–∏–∫–æ–º           | –¢–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏            |
| –ü–æ—Ç–µ—Ä—è —Å–æ—Å—Ç–æ—è–Ω–∏—è    | ‚úÖ –î–∞                          | ‚ùå –ù–µ—Ç (–ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ)    |
| –°–∫–æ—Ä–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)       | –ë—ã—Å—Ç—Ä–µ–µ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)          |
| –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ | –ù–µ—Ç (–æ–±—ã—á–Ω–æ –≤–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)| –î–∞ (`module.hot.accept`, Webpack config) |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞           | –ë–∞–∑–æ–≤–∞—è                        | –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –∫–æ–¥–∞   |

‚öôÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã HMR

–í–æ—Ç –∫—Ä–∞—Ç–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å:
	1.	üîå webpack-dev-server –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç WebSocket –∫ –∫–ª–∏–µ–Ω—Ç—É.
	2.	üìù Webpack –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ñ–∞–π–ª—ã. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è .hot-update.json –∏ .hot-update.js.
	3.	üì° –°–µ—Ä–≤–µ—Ä —É–≤–µ–¥–æ–º–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä —á–µ—Ä–µ–∑ —Å–æ–∫–µ—Ç.
	4.	üåê –ë—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è.
	5.	üîÑ Webpack runtime –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∞—Ç—á —á–µ—Ä–µ–∑ module.hot.accept.

üì¶ –ö–∞–∫–∏–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç HMR?

### üì¶ –ö–∞–∫–∏–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç HMR

| –¢–∏–ø —Ñ–∞–π–ª–æ–≤          | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HMR | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                     |
|---------------------|----------------|--------------------------------------------------|
| JavaScript-–º–æ–¥—É–ª–∏   | ‚úÖ –î–∞          | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –≤–∫–ª—é—á–∞—è `module.hot.accept()` |
| CSS                 | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ   | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ—Ä–µ–∑ `style-loader` –∏–ª–∏ –ø–ª–∞–≥–∏–Ω—ã      |
| React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã    | ‚úÖ –î–∞          | –ß–µ—Ä–µ–∑ `react-refresh` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è  |
| HTML                | ‚ùå –ù–µ—Ç         | –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞                    |
| WebAssembly         | ‚ùå –ù–µ—Ç         | –ü–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è                          |
| JSON                | ‚úÖ –î–∞          | –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –º–æ–¥—É–ª—å                      |

üìå –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞

–°–æ–∑–¥–∞–π –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç:

```sh
mkdir hmr-demo && cd hmr-demo
npm init -y
npm install webpack webpack-cli webpack-dev-server --save-dev
```

–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```sh
hmr-demo/
‚îú‚îÄ‚îÄ dist/
‚îÇ   ‚îî‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ index.js
‚îú‚îÄ‚îÄ webpack.config.js
```

dist/index.html:

```html
<!DOCTYPE html>
<html>
  <head><title>HMR Demo</title></head>
  <body>
    <div id="app">Hello World</div>
    <script src="main.js"></script>
  </body>
</html>
```

src/index.js:

```js
document.getElementById('app').textContent = 'HMR Active!';

if (module.hot) {
  module.hot.accept();
}
```

webpack.config.js:

```js
const path = require('path');
const webpack = require('webpack');

module.exports = {
  mode: 'development',
  entry: './src/index.js',
  output: {
    filename: 'main.js',
    path: path.resolve(__dirname, 'dist'),
  },
  devServer: {
    static: './dist',
    hot: true,
    port: 3000,
  },
  plugins: [
    new webpack.HotModuleReplacementPlugin(),
  ],
};
```

üöÄ –ó–∞–ø—É—Å—Ç–∏ dev-—Å–µ—Ä–≤–µ—Ä:

```sh
npx webpack serve
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å index.js, –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

‚úÖ –ó–∞–¥–∞–Ω–∏–µ 1 (–ø—Ä–∞–∫—Ç–∏–∫–∞)
	1.	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞.
	2.	–î–æ–±–∞–≤—å console.log –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏, –≤—ã–≤–æ–¥–∏—Ç—Å—è –ª–∏ –æ–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ ‚Äî –µ—Å–ª–∏ –Ω–µ—Ç, HMR —Ä–∞–±–æ—Ç–∞–µ—Ç!


üîπ –®–∞–≥ 2: HMR API ‚Äî –∫–∞–∫ –≤—Ä—É—á–Ω—É—é –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π

üìå –¶–µ–ª—å

–ü–æ–Ω—è—Ç—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ API module.hot, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–º, –∫–∞–∫ –º–æ–¥—É–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ, –µ—Å–ª–∏ –≤—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ:
	‚Ä¢	UI —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–æ—Ä–º—ã, React),
	‚Ä¢	–∏–≥—Ä–æ–≤—ã–µ –¥–≤–∏–∂–∫–∏ –∏–ª–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏,
	‚Ä¢	—Å–∏—Å—Ç–µ–º—É –ø–ª–∞–≥–∏–Ω–æ–≤ –∏–ª–∏ –º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã.

‚∏ª

üîß –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã HMR API

‚úÖ module.hot.accept([dependencies], callback)

–ü–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥—É–ª—é –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

```js
if (module.hot) {
  module.hot.accept('./math.js', function () {
    console.log('math.js –±—ã–ª –æ–±–Ω–æ–≤–ª—ë–Ω!');
  });
}
```

–ï—Å–ª–∏ accept –Ω–µ –≤—ã–∑–≤–∞—Ç—å, Webpack –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –º–æ–¥—É–ª—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–º–µ–Ω—ë–Ω –∏ –≤—ã–∑–æ–≤–µ—Ç –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É.

üîÅ module.hot.dispose(callback)

–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—á–∏—Å—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –ø–µ—Ä–µ–¥ –∑–∞–º–µ–Ω–æ–π –º–æ–¥—É–ª—è: —Ç–∞–π–º–µ—Ä—ã, –ø–æ–¥–ø–∏—Å–∫–∏, DOM –∏ —Ç.–¥.

```js
if (module.hot) {
  module.hot.dispose(() => {
    clearInterval(timer);
    console.log('–û—á–∏—Å—Ç–∫–∞ –º–æ–¥—É–ª—è –ø–µ—Ä–µ–¥ –∑–∞–º–µ–Ω–æ–π');
  });
}
```

üß† –ü—Ä–∏–º–µ—Ä: –°—á—ë—Ç—á–∏–∫ —Å –æ—á–∏—Å—Ç–∫–æ–π

src/index.js:

```js
let count = 0;
const el = document.getElementById('app');
const timer = setInterval(() => {
  el.textContent = `Coun111t: ${++count}`;
}, 1000);

if (module.hot) {
  module.hot.accept();

  module.hot.dispose(() => {
    clearInterval(timer);
    console.log('–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞');
  });
}
```

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞ —Å—á—ë—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è, –∞ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ ‚Äî –∏–º–µ–Ω–Ω–æ –∑–∞ —Å—á—ë—Ç dispose() –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.

### üß© –ö–æ–≥–¥–∞ –∏ –∑–∞—á–µ–º –Ω—É–∂–Ω–æ `accept()`

| –°—Ü–µ–Ω–∞—Ä–∏–π                             | –ù—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å `accept()`? | –ü—Ä–∏—á–∏–Ω–∞                                                                 |
|--------------------------------------|-----------------------------|-------------------------------------------------------------------------|
| –ò–∑–º–µ–Ω–∏–ª—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π –º–æ–¥—É–ª—å      | ‚úÖ –î–∞                       | –ë–µ–∑ `accept()` –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã                 |
| –ò–∑–º–µ–Ω–∏–ª–∞—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å | ‚úÖ –î–∞                       | –ß—Ç–æ–±—ã –ø—Ä–∏–Ω—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–µ—Å—å –±–∞–Ω–¥–ª     |
| –ú–æ–¥—É–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è         | ‚ùå –ù–µ—Ç                      | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Webpack –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, –µ—Å–ª–∏ –Ω–µ—Ç `accept()`        |
| –†–∞–±–æ—Ç–∞ —Å HTML, –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ –∏ —Å—Ç–∞—Ç–∏–∫–æ–π | ‚ùå –ù–µ—Ç                      | HMR –∏—Ö –Ω–µ –∫–∞—Å–∞–µ—Ç—Å—è ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏            |

üí° –°–æ–≤–µ—Ç—ã –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ HMR
	‚Ä¢	–û–±–æ—Ä–∞—á–∏–≤–∞–π module.hot –≤ if, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å production-—Å–±–æ—Ä–∫–µ.
	‚Ä¢	–î–µ–ª–∞–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∏ HMR-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ‚Äî —ç—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å.
	‚Ä¢	–î–ª—è React/Redux ‚Äî –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å react-refresh –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ middleware.

‚úÖ –ó–∞–¥–∞–Ω–∏–µ 2 (–ø—Ä–∞–∫—Ç–∏–∫–∞)
	1.	–°–æ–∑–¥–∞–π –≤—Ç–æ—Ä–æ–π –º–æ–¥—É–ª—å math.js —Å —Ñ—É–Ω–∫—Ü–∏–µ–π add(a, b).
	2.	–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –µ–≥–æ –≤ index.js, –≤—ã–≤–µ–¥–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —ç–∫—Ä–∞–Ω.
	3.	–î–æ–±–∞–≤—å accept('./math.js', ...), —á—Ç–æ–±—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ math.js –æ–±–Ω–æ–≤–ª—è–ª—Å—è —Ç–æ–ª—å–∫–æ –æ–Ω.
	4.	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

üìé –ü–æ–¥—Å–∫–∞–∑–∫–∞: math.js

```js
export function add(a, b) {
  return a + b;
}
```
